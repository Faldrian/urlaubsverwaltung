language: java

script: ./mvnw clean verify jacoco:report coveralls:report -P buildDockerContainer

jdk:
- oraclejdk8

services:
- docker

before_deploy:
- export JAR_FILE=$(ls target/urlaubsverwaltung-*.jar)
- echo "deploying $JAR_FILE to GitHub releases"
- export RELEASE_NOTES=$(node/node etc/getReleaseNotes.js)
- echo "create release notes $RELEASE_NOTES"

deploy:
  provider: releases
  api_key:
    secure: lEV9X4As9pSBZfJBWIvBzeqfOHGJojQHYYDkKqPb5TKwXjPcsWb/es+JeS6Yqx3hwxjpYL/p4FmczklaVqbABdrMAb+VkU504HwHdKz0qRl2o8Wkf2iCHrDAqTm/UYPPtfMr9RjRBNq8msCB6QChngnj3/C0moh/KUdgiMBPJEw=
  file: "${JAR_FILE}"
  body: "${RELEASE_NOTES}"
  skip_cleanup: true
  on:
    repo: synyx/urlaubsverwaltung
    tags: true
    jdk: oraclejdk8

env:
  global:
  - secure: jXp0Pv5N97fkMihfIHwj8ko2jY0zLwMr/bo87MxH8PEt1orQIG4S5qkYM/3AVsqRPRc/IvpOSWdz1x9z1vbGlzEpeKQmqrDrlnA8oUbTcjLTq5eDq0Na4m1ZdhKCN35pXLzA4jeKpuDW0J7uAOwljfZ5FBSwyJaEaoZiHnMKRSo=
  - secure: ZQDEV5TG6mMIaokbBZAdbyxaDGLHMrDD8Lf7HsK+BUbzuHFl8JY7b3d4IyEIV8NzC9sHanArjm4qrL31wm+iI9x3kU7hzec2lAM4B2aXmBNzSmOWKUvrkUVsEsjqKQAxbexjEwZDptxINBtJhZaGx5UrMcUBrZDRVIH34uUMf5E=
